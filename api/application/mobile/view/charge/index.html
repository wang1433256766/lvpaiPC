<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="msapplication-tap-highlight" content="no">
		<title></title>
		<style>
			*{margin: 0;padding: 0;box-sizing: border-box;}
			body{background: #f7f7f7;}
			.head{width: 100%;height: 45px;background: #59c2de;text-align: center;line-height: 45px;color: #fff;font-size: 18px;}
			.title{width: 100%;text-align: center;color: #999;font-size: 20px;font-weight: bold;margin-top: 38px;}
			.code-body{width: 100%;padding: 0 25px;}
			.code{width: 100%;color:#555;font-size: 60px;background: #fff;height: 120px;border: 1px solid #d5d5d5;margin-top: 20px;border-radius: 10px;outline:none;text-align: center;}
			.code-btn{width: 100%;height: 80px;background: #59bfd9;border-radius: 10px;outline:none;text-align: center;line-height: 80px;color: #fff;font-size: 30px;border: none;margin-top: 35px;}
			.info{
				margin-top: 20px;
			}
			.info span{
				text-align: center;
				font-size: 20px;
				display: block;
			}
			.bule{
				background-color: #59bfd9;
				width: 100px;
				height: 50px;
				text-align: center;
				border:0;
				margin: 0 auto;
				display: block
			}
			.red{
				background-color: red;
				width: 100px;
				height: 50px;
				text-align: center;
				border:0;
				margin: 0 auto;
				display: block
			}
			.hs{
				background-color: gray;
				width: 100px;
				height: 50px;
				text-align: center;
				border:0;
				margin: 0 auto;
				display: block
			}
		</style>
	</head>
	<body>
		<header class="head">门票核销</header>
		<div class="title">核销验证码</div>
		<div class="code-body">
			<input type="number" class="code" oninput="if(value.length>8)value=value.slice(0,8)" id="code" />
			<button class="code-btn">确 定</button>
		</div>
		<div class="info"></div>
	</body>
	<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script>
        $(document).on('click', '.code-btn', function() {
            var  code = $("#code").val();
			if (code == ''){
			    alert('检票码不能为空')
			}else {
                ajaxcode(code)
			}

        });
        function ajaxcode(code){
            $.ajax({
                url: "/mobile/charge/query",
                type:'post',
                data:{code: code},
                dateType:"json",
                success: function(res){
					var arr= JSON.parse(res);

					if (!arr[0]){
                        console.log(arr)
                        $(".info").html("<span>订单不存在</span>");
					}else{
                        var str = '';
                        for (var i=0;i<arr.length;i++){
                            str += '<span>'+arr[i].ticket_name+'</span>'
                            str += '<span>'+arr[i].num+'人</span>'
                            str += '<span>'+arr[i].id+'</span>'
                            if(arr[i].status == 1){
                                str += '<button class="bule" onclick = "charge_off('+arr[i].id+')">核销</button>'
							}else if(arr[i].status < 1){
                                str += '<button class="red">未支付</button>'
							}else{
                                str += '<button class="hs">已核销</button>'
							}
                        }
                        $(".info").html(str);
					}

                },
                error:function (re) {
                    console.log('qwq');
                    console.log(re);
                }
            });
        }
    function charge_off(index){
        $.ajax({
            url: "/mobile/charge/make",
            type:'post',
            data:{id: index},
            dateType:"json",
            success: function(res){
                var arr= JSON.parse(res);
                if(arr == '200')
                {
                	alert("核销成功!");
                	location.reload();
                }
            },
            error:function (re) {
                console.log('qwq');
                console.log(re);
            }
        });
	}
	</script>
</html>

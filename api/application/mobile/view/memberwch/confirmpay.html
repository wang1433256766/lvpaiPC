<!--Created by wyg on 2018/1/23-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <link rel="stylesheet" href="/static/mobile/wchuang/css/confirmationOrder.css">
    <link rel="stylesheet" href="/static/mobile/js/layer/mobile/need/layer.css">
    <title>提交订单</title>
    <script type="text/javascript">
        function leftTimer()
        {
             $(function(){
            var m=19;
            var s=59;
            setInterval(function(){
                if(s<10){
                    $('#time').html(m+':0'+s);
                }else{
                    $('#time').html(m+':'+s);
                }
                s--;
                if(s<0){
                    s=59;
                    m--;
                }
            },1000)
        })
        }
      
    </script>
</head>
<body onload="leftTimer()">
<div class="html">
    <header>
        <span class="left"><img src="/static/mobile/wchuang/img/back.png"></span>
        <p>提交订单</p>
        <span class="right"></span> <!--占位误删-->
    </header>
    <div class="content">
        <p class="surplusTime">
            <span>剩余支付时间</span>
            <span id="time">20:00</span>
        </p>
        <div class="bodyBox">
            <div>
                <p class="title">应付总额</p>
                <div class="bodyContent">
                    <p class="money">￥{$res_info.order_info.total_free}</p>
                    {if $res_info.order_info.total_free == 0}
                     <p class="money">￥ 0.01</p>
                     {else/}
                    <p class="money">￥{$res_info.order_info.total_free}</p>
                    {/if}
                    <p>
                        <span>{$res_info.product_info.name}</span>
                        <span>旅行币{$res_info.product_info.integral} <span class="color999">X{$res_info.order_info.pro_num}</span></span>
                    </p>
                    <p>
                        <span>旅游币抵扣</span>
                        <span class="color999 sc">￥{$res_info.product_info.integral/20}</span>
                    </p>
                </div>
            </div>
            <div>
                <p class="title">收货地址</p>
                <div class="bodyContent">
                    <p>
                        <span>{$res_info.address_info.username}</span>
                        <span>{$res_info.address_info.phone}</span>
                    </p>
                    <p>
                        <span>{$res_info.address_info.province_city}{$res_info.address_info.address}</span>
                    </p>
                </div>
            </div>
            
        </div>
        <p class="payType">支付方式</p>
        <div class="payTypeBox">
            <img src="/static/mobile/wchuang/img/wechat.png">
            <span>微信支付</span>
        </div>
    </div>
    <footer>
        <p onclick="callpay()">立即支付</p>
    </footer>
</div>
<script src="/static/mobile/wchuang/js/rem.js" type="text/javascript"></script>
<script src="/static/mobile/js/jquery-3.2.1.min.js"></script>
<script src="/static/mobile/js/layer/mobile/layer.js"></script>
<script type="text/javascript">
 
    console.log({$res});
    function callpay()
    {
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall();
        }
    }
    function jsApiCall()
    {
        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
            {$res},
            function(res){
               
                WeixinJSBridge.log(res.err_msg);
                // alert(res.err_msg);
                if (res.err_msg == 'get_brand_wcpay_request:ok') {
                    location.href='/mobile/orderwch/index'
                }else if(res.err_msg == 'get_brand_wcpay_request:cancel') {


                }else if(res.err_msg == 'get_brand_wcpay_request:fail') {

                }

            }
        );
    }

</script>
</body>
</html>
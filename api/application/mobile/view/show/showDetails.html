<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>秀秀详情</title> -->
    <link href="/static/index/css/css.css" rel="stylesheet"/>
</head>
<body>
	<header class="head-gugu">
		<a href="javascript:history.go(-1);">
			<img class="head-search" src="/static/index/images/show-back.png"/>
		</a>
		<h2>秀秀详情</h2>
		<span class="show-delete"><img src="/static/index/images/delete.png"></span>
	</header>
	<!--正文-->
		<div class="my-show" style="padding-top: 0.8rem;">
			<div class="con"><!--自适应包裹div-->
				<div class="gugu-cont">
					<!--列表内容-->
					<ul class="gugu-list">
						<li>
							<div class="gugu-list-tit layout">
								<img src={$showDetails.headimgurl} alt="" />
								<p>{$showDetails.nickname}</p>
								<span>{$showDetails.add_time}</span>
							</div>
							<div class="gugu-list-cont">
									<p class="gugu-list-text">
										{$showDetails.gugu_content}
									</p>
									<ul class="gugu-list-img">
										{volist name="showDetails['img_path']" id="v" }
										<li>
											<img src={$v}  alt="" />

										</li>
									
										{/volist}
									</ul>
									<div class="gugu-list-map">
										<p class="fl"><i></i><em>{$showDetails.address}</em></p>
										<ul>
											<li class="up up{$showDetails.article_id}" data-value="{$showDetails.is_up}"><span></span><b class="favor{$showDetails.article_id}">{$showDetails.favor_num}</b></li>
											<li data-value="{$showDetails.article_id}"><span><img src="/static/index/images/comment.png"></span><b class="comment_num">{$showDetails.comment_num}</b></li>
										</ul>
									</div>
							</div>
						</li>
					</ul>
					<!--列表内容结束-->
				</div>
			</div>
		</div>
		<div class="box-comment">
			<div class="comment-title">
				评论<span>（{$showDetails.comment_num}）</span>
			</div>
			<div class="comment-cnt">
			    {volist name="comment" id="k" offset="0" }
				<dl>
					<dt><img src={$k.headimg}></dt>
					<dd class="cmt-name">{$k.nickname}</dd>
					<dd>{$k.add_time}</dd>
					<p>{$k.content}</p>
				</dl>
			   {/volist}
			</div>
		</div>
		<div class="cmt-nr">
			<p><input class="comment" type="text" placeholder="我要评论"><i><img src="/static/index/images/icon-cmt.png"></i></p>
			<span style="display: none;" class="submit">提交</span>
		</div>
	<!--正文结束-->
	<script src="/static/index/js/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="/static/index/js/rem.js" type="text/javascript"></script>
<script>
		$(function(){
			$('.cmt-nr input').focus(function(){
	            $('.cmt-nr p').addClass('active');
	            $('.cmt-nr span').show();
	    	})
		})


//图标默认点亮
   $("li").each(function(){
    	if($(this).attr('data-value') == 1){
    	$(this).addClass('active');
       };
  });


      //点赞
			$(".up").click(function(){
				 var  is_up=$(this).attr('data-value');
				var url = "{:url('show/up')}"; 
				var article_id= $(this).next().attr('data-value');
				//console.log(article_id);
				
				 //console.log(is_up);
				 if(is_up==0){
							    $.ajax({
								              type:'post',
										      url:url,
										      data: {"article_id":article_id},
										      dataType:'html',
										      success:function(data){
											  // console.log(data);
										       $(".up"+article_id).addClass('active');
											   $(".up"+article_id).attr('data-value',"1");
                                               var favor_num =parseInt( $(".up"+article_id).text() );
                                               $(".favor"+article_id).text(favor_num+1);
										     }
										  });
				              }
				             else{
					             	$.ajax({
									              type:'post',
											      url:url,
											      data: {"article_id":article_id},
											      dataType:'html',
											      success:function(data){
												  // console.log(data);
											       $(".up"+article_id).removeClass('active');
                                                    $(".up"+article_id).attr('data-value',"0");
                                                    var favor_num =parseInt( $(".up"+article_id).text() );
                                                    $(".favor"+article_id).text(favor_num-1);
											     }
											  });
				             }
			});

//评论
$(".submit").click(function(){
   var gugu_content=$(".comment").val();
   var article_id= $(".up").next().attr('data-value');
    if(gugu_content){
                              var url = "{:url('show/subComment')}"; 
                              $.ajax({

									              type:'post',
											      url:url,
											      data: {"gugu_content":gugu_content,"article_id":article_id},
											      dataType:'json',
											      success:function(data){

												   //console.log(data.info); prepend
												   $('.comment-cnt').append('<dl><dt><img src='+data.headimg+'></dt><dd class="cmt-name">'+data.nickname+'</dd><dd>'+data.add_time+'</dd><p>'+data.info+'</p></dl>'); 
												   var comment_num=parseInt($('.comment_num').text()); 
												   $('.comment_num').text(comment_num+1);
												    $('.comment').val(' ');
												    }
											  });

    }




});

//删除秀秀
$(".show-delete").click(function(){
       var article_id= $(".up").next().attr('data-value');
       var url = "{:url('show/delXiu')}";
                                        $.ajax({

									              type:'post',
											      url:url,
											      data: {"article_id":article_id},
											      dataType:'json',
											      success:function(data){
                                                    
												    if(data==1){
												    	window.history.go(-1);
												    }

												    }
											  });

});
	</script>
</body>
</html>
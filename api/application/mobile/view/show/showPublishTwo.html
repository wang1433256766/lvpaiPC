<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>秀一秀</title>
    <link href="/static/mobile/css/css.css" rel="stylesheet"/>
     <script type="text/javascript" src="/static/mobile/js/jquery.min.js"></script>
<!--       <script src="/static/mobile/js/vconsole.min.js"></script>
    <script>
        var vConsole = new VConsole();
        vConsole.setOption({maxLogNumber: 5000});
    </script> -->
    <style type="text/css">
        
       
    </style>
</head>
<body>
	<header class="head-gugu">
		<a href="javascript:history.go(-1);">
			<img class="head-search" src="/static/mobile/images/show-back.png"/>
		</a>
		<h2>秀一秀</h2>
		<span onclick="submit()">发表</span>
	</header>
	<!--正文-->
		<div class="my-show" style="padding-top: 0.8rem;">
			<div class="text-cnt"><textarea id="gugu_content" placeholder="秀秀你的旅拍…"></textarea></div>

              <div style="padding-left: 10px;">
                    <ul class="upload-ul clearfix">
                    <li class="upload-pick">
                   <div class="webuploader-container clearfix" id="goodsUpload"></div>
                   </li>
                   </ul>
             </div>

			<div class="location">
				<p class="chooseAddress">
					<img src="/static/mobile/images/map_bg.png">所在位置
					<span><img src="/static/mobile/images/show-next.png"></span>
				</p>
			</div>
		</div>
		<div class="cansee">
			<p><img src="/static/mobile/images/show-see.png">仅对自己可见</p>
			<span></span>
		</div>
	<!--正文结束-->
	<script src="/static/mobile/js/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="/static/mobile/js/rem.js" type="text/javascript"></script>
	<script src="/static/mobile/js/webuploader.min.js"></script>
	<script src="/static/mobile/js/diyUpload.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>


<script>


//发表
function submit()
    {
        

        var img = $('.img');
          var gugu_content=$("#gugu_content").val();
          var address=$(".addressHave").val();
          if(address==undefined){address='';}
          if(img==''&&gugu_content==''){
        	window.alert('请输入内容');
        }
        //return;  
        // var title = $('#title').val();
       // var address = $('#address').val();
         console.log(img);
        var i = 0;
        var img_arr = [];
        for (i=0; i<img.length; i++)
        {
            if (i < 9)
            {
                img_arr[i] = img[i].src;
            }
        }
        console.log(img_arr);
        $.ajax({
            'type' : 'post',
            'url' : "{:url('show/dUpload')}",
            'data' : {img:img_arr, gugu_content:gugu_content,address:address},
            'dataType' : 'json',
           
            success: function(data) {
           
				if (data) { window.history.go(-1);}
            }
        });
       
    }

//上传图片
$(function(){
	
var $tgaUpload = $('#goodsUpload').diyUpload({

        url:'/uploadFilePath',
        success:function( data ) { },
        error:function( err ) { },
        buttonText : '',
        accept: {
            title: "Images",
            extensions: 'gif,jpg,jpeg,bmp,png'
        },
        thumb:{
            width:800,
            height:1142,
            quality:200,
            allowMagnify:true,
            crop:true,
            type:"image/jpeg"
        }
    });


});
//微信参数
  wx.config({
      debug: false,
      appId: "{$js_sign['appid']}",
      timestamp: "{$js_sign['timestamp']}",
      nonceStr:  "{$js_sign['nonceStr']}",
      signature: "{$js_sign['signature']}",
      jsApiList: [
        'chooseImage',
        'uploadImage',
        'getLocation'
      ]
  });

//微信定位
    $(".chooseAddress").bind("click",function (){  
    var latitude=0;
    var longitude=0;   
      wx.getLocation({
                      type: 'gcj02', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                      success: function (res) {
                      var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                      var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                      var speed = res.speed; // 速度，以米/每秒计
                      var accuracy = res.accuracy; // 位置精度 

                        $.ajax({
                                      'type' : 'post',
                                      'url' : "{:url('show/gaode')}", //传给高德定位方法
                                      'data' : {'latitude':latitude,'longitude':longitude},
                                      'dataType' : 'json',
                                      success : function(msg)
                                      {
                                       // console.log(msg);
                                        var node='';
                                        for (var i = 0; i < msg.length; i++) {
                                          node+='<option>'+msg[i]+'</option>'
                                        }
                                        console.log( node);
                                         $(".chooseAddress").hide();
                                       $(".location").append('<select style="font-size:0.34rem;padding:0 0.3rem;height:0.96rem;line-height:0.96rem; width:100%;border-color:#ededed;background-color:#fff;" class="addressHave">'+node+'</select>');
                                  
                                      }
                                  });        
                      }

                      });

    
      });
   //改变地址信息
            $(document).on("change",".addressHave",function () {  
                  if (this.value!='' ){
                      var address= this.value;
                      
                       $(".addressHave").hide();
                       $(".chooseAddress").html('<img src="/static/index/images/map_bg.png">'+address
                                                 +'<span ><img src="/static/index/images/show-next.png"></span>');
                    
                       $(".chooseAddress").show();

                     }  
                  
                });  
            
  </script>

</body>
</html>
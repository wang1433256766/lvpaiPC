<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>新闻列表</title>

    <link rel="shortcut icon" href="/static/admin/images/zhlfavicon.ico">

    <link href="/static/admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">

    <link href="/static/admin/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">

    <link href="/static/admin/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">

    <link href="/static/admin/css/animate.min.css" rel="stylesheet">

    <link href="/static/admin/css/style.min.css?v=4.1.0" rel="stylesheet">

    <link href="/static/admin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">

</head>

<body class="gray-bg">

<div class="wrapper wrapper-content animated fadeInRight">

    <!-- Panel Other -->

    <div class="ibox float-e-margins">

        <div class="ibox-title">

            <h5>新闻列表</h5>

        </div>

        <div class="page-heading"></div>

        <div class="ibox-content">

            <!--搜索框开始-->

            <form id='commentForm' role="form" method="post" class="form-inline">

                <div class="content clearfix m-b">

                    <div class="form-group">

                        <label>关键词：</label>

                        <input type="text" class="form-control" id="username" name="username">

                    </div>

                    <div class="form-group">

                        <button class="btn btn-primary" type="button" style="margin-top:5px" id="search"><strong>搜 索</strong>

                        </button>

                    </div>

                    <div class="form-group clearfix col-sm-1" style="width:440px;float:right;">

                    <span  class="btn btn-outline btn-primary" data-toggle="modal" data-target="#myModal1">惠说新闻</span>

                    <span class="btn btn-outline btn-primary" data-toggle="modal" data-target="#myModal2">有声旅行</span>

                    <span  class="btn btn-outline btn-primary" data-toggle="modal" data-target="#myModal3">有料旅行</span>

                    <span  class="btn btn-outline btn-primary" data-toggle="modal" data-target="#myModal4">不惠你看</span>

                    

            </div>

                </div>

            </form>

            <!--搜索框结束-->

            <div class="hr-line-dashed"></div>



            <div class="example-wrap">

                <div class="example">

                    <table id="cusTable" data-height="700">

                        <thead>

                        <th data-field="title">文章标题</th>
                        <th data-field="name">栏目</th>
                        <th data-field="nickname">作者</th>
                        <th data-field="read_num">阅读量</th>
                        <th data-field="favor_num">点赞量</th>
                        <th data-field="operate">操作</th>

                        </thead>

                    </table>

                </div>

            </div>

            <!-- End Example Pagination -->

        </div>

    </div>

</div>



<div class="modal inmodal" id="myModal1" tabindex="-1" role="dialog" aria-hidden="true">

<form  action="/admin/topic/hsxwload"  id="commentForm" method="post" enctype="multipart/form-data">

      <div class="modal-dialog">

           <div class="modal-content animated bounceInRight">

                <div class="modal-header">

                     <span style="float:left;font-size:16px;"><b>惠说新闻</b></span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>

                </div>

                <div class="modal-body">

                	<div class="form-group">

                            <label class="col-sm-3 control-label"></label>

                            <div style="position:relative;" class="input-group col-sm-4">

                                <img src="" height="160" width="200" alt="请选择图片" style=""/><br/>

                                <label for="thumb" style="width:70px;height:30px;line-height:30px;text-align:center;color:#fff;background:#1AB395;position:absolute;top:170px;left:0;border-radius:5px;display:block;">

                                选择文件

                                </label>

                                <input style="height:30px;margin-top:10px;border-radius:5px;" id="thumb" type="file" onchange="previewFile()" name="thumb"><br/>

                            </div>

                        </div>

                    <div class="form-group">

                    	<label for="url">惠说新闻地址</label> 

                    		<input name="url" id="url" type="text" placeholder="请输入地址" class="form-control">

                    </div>

                </div>

                <div class="modal-footer">

                      <button type="button" class="btn btn-white" data-dismiss="modal" id="delete" onclick="del(0)">关闭</button>

                      <button type="submit" class="btn btn-primary" id="save" >保存</button>

                </div>

             </div>

       </div>

        </form>

 </div>



 <div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true">

<form  action="/admin/topic/yslxload"  id="commentForm" method="post" enctype="multipart/form-data">

      <div class="modal-dialog">

           <div class="modal-content animated bounceInRight">

                <div class="modal-header">

                     <span style="float:left;font-size:16px;"><b>有声旅行</b></span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>

                </div>

                <div class="modal-body">

                	<div class="form-group">

                            <label class="col-sm-3 control-label"></label>

                            <div style="position:relative;" class="input-group col-sm-4">

                                <img src="" height="160" width="200" alt="请选择图片" style=""/><br/>

                                <label for="thumb" style="width:70px;height:30px;line-height:30px;text-align:center;color:#fff;background:#1AB395;position:absolute;top:170px;left:0;border-radius:5px;display:block;">

                                选择文件

                                </label>

                                <input style="height:30px;margin-top:10px;border-radius:5px;" id="thumb" type="file" onchange="previewFile1()" name="thumb"><br/>

                            </div>

                        </div>

                    <div class="form-group">

                    	<label for="url">有声旅行地址</label> 

                    		<input name="url" id="url" type="text" placeholder="请输入地址" class="form-control">

                    </div>

                </div>

                <div class="modal-footer">

                      <button type="button" class="btn btn-white" data-dismiss="modal" id="delete" onclick="del(0)">关闭</button>

                      <button type="submit" class="btn btn-primary" id="save" >保存</button>

                </div>

             </div>

       </div>

        </form>

 </div>

 <div class="modal inmodal" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true">

<form  action="/admin/topic/yllxload"  id="commentForm" method="post" enctype="multipart/form-data">

      <div class="modal-dialog">

           <div class="modal-content animated bounceInRight">

                <div class="modal-header">

                     <span style="float:left;font-size:16px;"><b>有料旅行</b></span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>

                </div>

                <div class="modal-body">

                	<div class="form-group">

                            <label class="col-sm-3 control-label"></label>

                            <div style="position:relative;" class="input-group col-sm-4">

                                <img src="" height="160" width="200" alt="请选择图片" style=""/><br/>

                                <label for="thumb" style="width:70px;height:30px;line-height:30px;text-align:center;color:#fff;background:#1AB395;position:absolute;top:170px;left:0;border-radius:5px;display:block;">

                                选择文件

                                </label>

                                <input style="height:30px;margin-top:10px;border-radius:5px;" id="thumb" type="file" onchange="previewFile2()" name="thumb"><br/>

                            </div>

                        </div>

                    <div class="form-group">

                    	<label for="url">有料旅行地址</label> 

                    		<input name="url" id="url" type="text" placeholder="请输入地址" class="form-control">

                    </div>

                </div>

                <div class="modal-footer">

                      <button type="button" class="btn btn-white" data-dismiss="modal" id="delete" onclick="del(0)">关闭</button>

                      <button type="submit" class="btn btn-primary" id="save" >保存</button>

                </div>

             </div>

       </div>

        </form>

 </div>

 <div class="modal inmodal" id="myModal4" tabindex="-1" role="dialog" aria-hidden="true">

<form  action="/admin/topic/bhnkload"  id="commentForm" method="post" enctype="multipart/form-data">

      <div class="modal-dialog">

           <div class="modal-content animated bounceInRight">

                <div class="modal-header">

                     <span style="float:left;font-size:16px;"><b>不惠你看</b></span><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>

                </div>

                <div class="modal-body">

                	<div class="form-group">

                            <label class="col-sm-3 control-label"></label>

                            <div style="position:relative;" class="input-group col-sm-4">

                                <img src="" height="160" width="200" alt="请选择图片" style=""/><br/>

                                <label for="thumb" style="width:70px;height:30px;line-height:30px;text-align:center;color:#fff;background:#1AB395;position:absolute;top:170px;left:0;border-radius:5px;display:block;">

                                选择文件

                                </label>

                                <input style="height:30px;margin-top:10px;border-radius:5px;" id="thumb" type="file" onchange="previewFile3()" name="thumb"><br/>

                            </div>

                        </div>

                    <div class="form-group">

                    	<label for="url">不惠你看地址</label> 

                    		<input name="url" id="url" type="text" placeholder="请输入地址" class="form-control">

                    </div>

                </div>

                <div class="modal-footer">

                      <button type="button" class="btn btn-white" data-dismiss="modal" id="delete" onclick="del(0)">关闭</button>

                      <button type="submit" class="btn btn-primary" id="save" >保存</button>

                </div>

             </div>

       </div>

        </form>

 </div>

<!-- End Panel Other -->

</div>

<script src="/static/admin/js/jquery.min.js?v=2.1.4"></script>

<script src="/static/admin/js/bootstrap.min.js?v=3.3.6"></script>

<script src="/static/admin/js/content.min.js?v=1.0.0"></script>

<script src="/static/admin/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>

<script src="/static/admin/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>

<script src="/static/admin/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

<script src="/static/admin/js/plugins/suggest/bootstrap-suggest.min.js"></script>

<script src="/static/admin/js/plugins/layer/laydate/laydate.js"></script>

<script src="/static/admin/js/plugins/sweetalert/sweetalert.min.js"></script>

<script src="/static/admin/js/plugins/layer/layer.min.js"></script>

<script src="/static/admin/js/scripts.js"></script>

<script type="text/javascript">

    function initTable() {

        //先销毁表格

        $('#cusTable').bootstrapTable('destroy');

        //初始化表格,动态从服务器加载数据

        $("#cusTable").bootstrapTable({

            method: "get",  //使用get请求到服务器获取数据

            url: "./index", //获取数据的地址

            striped: true,  //表格显示条纹

            pagination: true, //启动分页

            pageSize: 10,  //每页显示的记录数

            pageNumber:1, //当前第几页

            pageList: [5, 10, 15, 20, 25],  //记录数可选列表

            sidePagination: "server", //表示服务端请求

            //设置为undefined可以获取pageNumber，pageSize，searchText，sortName，sortOrder

            //设置为limit可以获取limit, offset, search, sort, order

            queryParamsType : "undefined",

            queryParams: function queryParams(params) {   //设置查询参数

                var param = {

                    pageNumber: params.pageNumber,

                    pageSize: params.pageSize,

                    searchText:$('#username').val(),

                };

                return param;

            },

            onLoadSuccess: function(){  //加载成功时执行

                layer.msg("加载成功", {time : 1000});

            },

            onLoadError: function(){  //加载失败时执行

                layer.msg("加载数据失败");

            }

        });

    }



    $(document).ready(function () {

        //调用函数，初始化表格

        initTable();



        //当点击查询按钮的时候执行

        $("#search").bind("click", initTable);

    });



    function newsDel(id){

        layer.confirm('确认删除?', {icon: 3, title:'提示'}, function(index){

            //do something

            $.getJSON('./newsDel', {'id' : id}, function(res){

                if(res.code == 1){

                    layer.alert('删除成功');

                    initTable();

                }else{

                    layer.alert('删除失败');

                }

            });



            layer.close(index);

        })



    }

  /*   

    

  //导入有声旅行

    function yslx()

    {

        var url = $("#url").val();

        console.log(url);

        console.log("url");



        success_msg($('.page-heading'),'正在处理数据，请不要关闭页面');

        $.post('/admin/topic/yslxload.html',{ url:url },function(res){

                if (res.status) {

                    window.location.reload();

                    $(".close").click();

                }else{

                    error_msg($('.page-heading'),'导入失败！');

                }

        },'json')

    }

  

  //导入有料旅行

    function yllx()

    {

        var url = $("#url").val();

        console.log(url);

        console.log("url");



        success_msg($('.page-heading'),'正在处理数据，请不要关闭页面');

        $.post('/admin/topic/yllxload.html',{ url:url },function(res){

                if (res.status) {

                    window.location.reload();

                    $(".close").click();

                }else{

                    error_msg($('.page-heading'),'导入失败！');

                }

        },'json')

    }

  

  //导入不惠你看

    function bhnk()

    {

        var url = $("#url").val();

        success_msg($('.page-heading'),'正在处理数据，请不要关闭页面');

        $.post('/admin/topic/bhnkload.html',{ url:url },function(res){

                if (res.status) {

                    window.location.reload();

                    $(".close").click();

                }else{

                    error_msg($('.page-heading'),'导入失败！');

                }

        },'json')

    }

   */

  //惠说新闻图片预览

    function previewFile() {

     var preview = document.querySelector('img');

     var file  = document.querySelector('input[type=file]').files[0];

     var reader = new FileReader();

     reader.onloadend = function () {

      preview.src = reader.result;

     }

     if (file) {

      reader.readAsDataURL(file);

     } else {

      preview.src = "";

     }

    }

   

 //有声旅行图片预览

   function previewFile1() {

    var preview = document.querySelector('#myModal2 img');

    var file  = document.querySelector('input[type=file]').files[0];

    var reader = new FileReader();

    reader.onloadend = function () {

     preview.src = reader.result;

    }

    if (file) {

     reader.readAsDataURL(file);

    } else {

     preview.src = "";

    }

   }

 

 //有料旅行图片预览

   function previewFile2() {

    var preview = document.querySelector('#myModal3 img');

    var file  = document.querySelector('input[type=file]').files[0];

    var reader = new FileReader();

    reader.onloadend = function () {

     preview.src = reader.result;

    }

    if (file) {

     reader.readAsDataURL(file);

    } else {

     preview.src = "";

    }

   }

 

 //不惠你看图片预览

   function previewFile3() {

    var preview = document.querySelector('#myModal4 img');

    var file  = document.querySelector('input[type=file]').files[0];

    var reader = new FileReader();

    reader.onloadend = function () {

     preview.src = reader.result;

    }

    if (file) {

     reader.readAsDataURL(file);

    } else {

     preview.src = "";

    }

   }



    function textDel(id){

        layer.confirm('确认删除?', {icon: 3, title:'提示'}, function(index){

            //do something

            $.getJSON('./newsDel', {'id' : id}, function(res){

                if(res.code == 1){

                    layer.alert('删除成功');

                    initTable();

                }else{

                    layer.alert('删除失败');

                }

            });



            layer.close(index);

        })



    }

    // 改变专题新闻的阅读量
    function changeReadNum(id, value)
    {
        $.ajax({
            'type' : 'post',
            'url' : "{:url('changeReadNum')}",
            'data' : {'id':id, 'value':value},
            'dataType' : 'json',
            success: function(msg)
            {
                if (0 == msg.status)
                {
                    console.log('修改未成功');
                }
                else
                {
                    console.log('修改成功');
                }
            }
        }); 

    }
    
    // 修改专题的点赞数量
    function changeFavorNum(id, value)
    {
        $.ajax({
            'type' : 'post',
            'url' : "{:url('changeFavorNum')}",
            'data' : {'id':id, 'value':value},
            'dataType' : 'json',
            success : function(msg)
            {
                if (0 == msg.status)
                {
                    console.log('修改未成功');
                }
                else
                {
                    console.log('修改成功');
                }
            }
        });
    }

</script>

</body>

</html>

